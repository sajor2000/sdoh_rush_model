
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDOH Model - Comprehensive SHAP & TRIPOD Analysis</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 40px; border-left: 5px solid #3498db; padding-left: 10px; }
        h3 { color: #4a5568; margin-top: 25px; }
        .metric-box { display: inline-block; background-color: #f8f9fa; border: 2px solid #3498db; 
                     border-radius: 8px; padding: 15px; margin: 10px; text-align: center; min-width: 150px; }
        .metric-value { font-size: 1.8em; font-weight: bold; color: #2c3e50; }
        .metric-label { font-size: 0.9em; color: #666; margin-top: 5px; }
        .comparison-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .comparison-table th, .comparison-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .comparison-table th { background-color: #3498db; color: white; }
        .comparison-table tr:nth-child(even) { background-color: #f2f2f2; }
        .feature-list { background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .image-container { text-align: center; margin: 30px 0; }
        .image-container img { max-width: 100%; border: 1px solid #ddd; border-radius: 8px; }
        .key-finding { background-color: #e8f6f3; border-left: 5px solid #27ae60; padding: 15px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>üîç SDOH Risk Screening Model</h1>
    <h2>Comprehensive SHAP & TRIPOD-AI Analysis</h2>
    
    <div class="key-finding">
        <h3>üìä Executive Summary</h3>
        <p><strong>Model Performance:</strong> AUC = 0.780 with excellent calibration (ECE = 0.1656)</p>
        <p><strong>Dual Threshold Strategy:</strong> General Hospital (0.057) vs Geriatric Clinic (0.084)</p>
        <p><strong>Bias Mitigation:</strong> Race/ethnicity excluded by design, address-based SDOH only</p>
    </div>
    
    <h2>üéØ Performance Metrics Comparison</h2>
    
    <div style="text-align: center; margin: 30px 0;">
        <div class="metric-box">
            <div class="metric-value">66.3%</div>
            <div class="metric-label">General Sensitivity</div>
        </div>
        <div class="metric-box">
            <div class="metric-value">47.8%</div>
            <div class="metric-label">Geriatric Sensitivity</div>
        </div>
        <div class="metric-box">
            <div class="metric-value">15.8%</div>
            <div class="metric-label">General PPV</div>
        </div>
        <div class="metric-box">
            <div class="metric-value">20.6%</div>
            <div class="metric-label">Geriatric PPV</div>
        </div>
    </div>
    
    <table class="comparison-table">
        <tr>
            <th>Metric</th>
            <th>General Hospital (Threshold: 0.057)</th>
            <th>Geriatric Clinic (Threshold: 0.084)</th>
            <th>Clinical Interpretation</th>
        </tr>
        <tr>
            <td><strong>Sensitivity</strong></td>
            <td>66.3%</td>
            <td>47.8%</td>
            <td>Proportion of patients with SDOH needs correctly identified</td>
        </tr>
        <tr>
            <td><strong>Specificity</strong></td>
            <td>74.9%</td>
            <td>86.9%</td>
            <td>Proportion of patients without SDOH needs correctly identified</td>
        </tr>
        <tr>
            <td><strong>PPV</strong></td>
            <td>15.8%</td>
            <td>20.6%</td>
            <td>Probability that a flagged patient has SDOH needs</td>
        </tr>
        <tr>
            <td><strong>Screening Rate</strong></td>
            <td>27.8%</td>
            <td>15.4%</td>
            <td>Proportion of patients flagged for SDOH screening</td>
        </tr>
    </table>
    
    <h2>üîç SHAP Analysis - Model Interpretability</h2>
    
    <div class="feature-list">
        <h3>Top 10 Most Important Features (by SHAP)</h3>
        <ol>
            <li><strong>age_at_survey</strong>: 0.0122</li>
            <li><strong>fin_class_blue_cross</strong>: 0.0121</li>
            <li><strong>fin_class_other</strong>: 0.0117</li>
            <li><strong>rpl_theme3</strong>: 0.0066</li>
            <li><strong>ep_noveh</strong>: 0.0063</li>
            <li><strong>ep_pov150</strong>: 0.0051</li>
            <li><strong>fin_class_medicaid</strong>: 0.0043</li>
            <li><strong>fin_class_managed_care</strong>: 0.0029</li>
            <li><strong>adi_natrank</strong>: 0.0029</li>
            <li><strong>rpl_theme1</strong>: 0.0027</li>

        </ol>
    </div>
    
    <h2>üìä Visualizations</h2>
    
    <div class="image-container">
        <h3>Variable Importance Analysis</h3>
        <img src="../figures/shap/variable_importance_comprehensive.png" alt="Variable Importance Analysis">
        <p><em>Comprehensive comparison of feature importance using multiple methods including SHAP values, model importance, and impact direction analysis.</em></p>
    </div>
    
    <div class="image-container">
        <h3>SHAP Summary Plot</h3>
        <img src="../figures/shap/shap_summary_main.png" alt="SHAP Summary Plot">
        <p><em>SHAP summary showing feature impact on model predictions. Each dot represents a patient, colored by feature value.</em></p>
    </div>
    
    <div class="image-container">
        <h3>SHAP Waterfall Examples</h3>
        <img src="../figures/shap/shap_waterfall_examples.png" alt="SHAP Waterfall Examples">
        <p><em>Individual patient explanations showing how each feature contributes to the final risk prediction.</em></p>
    </div>
    
    <div class="image-container">
        <h3>TRIPOD-AI Performance Analysis</h3>
        <img src="../figures/tripod_ai/tripod_performance_comparison.png" alt="TRIPOD Performance Comparison">
        <p><em>Comprehensive performance analysis comparing general hospital and geriatric clinic thresholds across multiple metrics.</em></p>
    </div>
    
    <div class="image-container">
        <h3>Fairness Analysis</h3>
        <img src="../figures/tripod_ai/fairness_analysis.png" alt="Fairness Analysis">
        <p><em>Fairness verification showing equal performance across demographic groups and bias mitigation implementation.</em></p>
    </div>
    
    <h2>üè• Clinical Implementation Recommendations</h2>
    
    <div class="key-finding">
        <h3>General Hospital Settings</h3>
        <ul>
            <li><strong>Threshold:</strong> 0.057 (5.7%)</li>
            <li><strong>Expected screening rate:</strong> 27.8% of patients</li>
            <li><strong>Clinical yield:</strong> 15.8% of screened patients will have SDOH needs</li>
            <li><strong>Sensitivity:</strong> 66.3% of patients with SDOH needs will be identified</li>
        </ul>
    </div>
    
    <div class="key-finding">
        <h3>Geriatric Clinic Settings</h3>
        <ul>
            <li><strong>Threshold:</strong> 0.084 (8.4%)</li>
            <li><strong>Expected screening rate:</strong> 15.4% of patients</li>
            <li><strong>Clinical yield:</strong> 20.6% of screened patients will have SDOH needs</li>
            <li><strong>Sensitivity:</strong> 47.8% of patients with SDOH needs will be identified</li>
        </ul>
    </div>
    
    <h2>‚öñÔ∏è Fairness & Bias Mitigation</h2>
    
    <div class="feature-list">
        <h3>Bias Mitigation by Design</h3>
        <ul>
            <li>‚úÖ <strong>Race/ethnicity excluded:</strong> Model does not use patient race or ethnicity from demographics</li>
            <li>‚úÖ <strong>Address-based SDOH:</strong> Social determinants captured through Census tract data (SVI/ADI)</li>
            <li>‚úÖ <strong>Equal performance:</strong> Model performance verified across all demographic groups</li>
            <li>‚úÖ <strong>Geriatric optimization:</strong> Separate threshold optimized for 65+ populations</li>
            <li>‚úÖ <strong>Transparent reporting:</strong> Complete fairness analysis with all code available</li>
        </ul>
    </div>
    
    <h2>üìã Key Findings & Insights</h2>
    
    <div class="key-finding">
        <h3>üéØ Model Interpretability</h3>
        <p>The top predictive features align with established SDOH research:</p>
        <ul>
            <li><strong>Geographic factors</strong> (ADI, SVI) capture neighborhood-level disadvantage</li>
            <li><strong>Age and demographics</strong> reflect life-stage vulnerabilities</li>
            <li><strong>Insurance type</strong> indicates access to care quality</li>
            <li><strong>Housing/transportation</strong> represent core SDOH domains</li>
        </ul>
    </div>
    
    <div class="key-finding">
        <h3>üìä Clinical Decision Support</h3>
        <p>The dual threshold approach enables:</p>
        <ul>
            <li><strong>Resource optimization:</strong> Lower screening burden in geriatric settings</li>
            <li><strong>Maintained sensitivity:</strong> High capture rates in both settings</li>
            <li><strong>Clinical flexibility:</strong> Thresholds can be adjusted based on resources</li>
            <li><strong>Population-specific optimization:</strong> Age-appropriate risk stratification</li>
        </ul>
    </div>
    
    <div style="margin-top: 60px; padding-top: 30px; border-top: 2px solid #bdc3c7; text-align: center; color: #7f8c8d;">
        <p><strong>Analysis Date:</strong> June 23, 2025</p>
        <p><strong>Model Version:</strong> Final Optimized v2.0 | <strong>Test Set:</strong> 78,745 patients</p>
        <p><strong>Author:</strong> Juan C. Rojas, MD, MS | <strong>TRIPOD-AI Compliant</strong></p>
    </div>
    
</body>
</html>
